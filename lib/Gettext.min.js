Gettext=function(t){this.domain="messages",this.locale_data=void 0;var e=["domain","locale_data"];if(this.isValidObject(t))for(var a in t)for(var r=0;r<e.length;r++)a==e[r]&&this.isValidObject(t[a])&&(this[a]=t[a]);return this.try_load_lang(),this},Gettext.context_glue="",Gettext._locale_data={},Gettext.prototype.try_load_lang=function(){if("undefined"!=typeof this.locale_data){var t=this.locale_data;if(this.locale_data=void 0,this.parse_locale_data(t),"undefined"==typeof Gettext._locale_data[this.domain])throw new Error("Error: Gettext 'locale_data' does not contain the domain '"+this.domain+"'")}var e=this.get_lang_refs();if("object"==typeof e&&e.length>0)for(var a=0;a<e.length;a++){var r=e[a];if("application/json"==r.type){if(!this.try_load_lang_json(r.href))throw new Error("Error: Gettext 'try_load_lang_json' failed. Unable to exec xmlhttprequest for link ["+r.href+"]")}else{if("application/x-po"!=r.type)throw new Error("TODO: link type ["+r.type+"] found, and support is planned, but not implemented at this time.");if(!this.try_load_lang_po(r.href))throw new Error("Error: Gettext 'try_load_lang_po' failed. Unable to exec xmlhttprequest for link ["+r.href+"]")}}},Gettext.prototype.parse_locale_data=function(t){"undefined"==typeof Gettext._locale_data&&(Gettext._locale_data={});for(var e in t)if(t.hasOwnProperty(e)&&this.isValidObject(t[e])){var a=!1;for(var r in t[e]){a=!0;break}if(a){var n=t[e];""==e&&(e="messages"),this.isValidObject(Gettext._locale_data[e])||(Gettext._locale_data[e]={}),this.isValidObject(Gettext._locale_data[e].head)||(Gettext._locale_data[e].head={}),this.isValidObject(Gettext._locale_data[e].msgs)||(Gettext._locale_data[e].msgs={});for(var i in n)if(""==i){var o=n[i];for(var s in o){var l=s.toLowerCase();Gettext._locale_data[e].head[l]=o[s]}}else Gettext._locale_data[e].msgs[i]=n[i]}}for(var e in Gettext._locale_data)if(this.isValidObject(Gettext._locale_data[e].head["plural-forms"])&&"undefined"==typeof Gettext._locale_data[e].head.plural_func){var p=Gettext._locale_data[e].head["plural-forms"],d=new RegExp("^(\\s*nplurals\\s*=\\s*[0-9]+\\s*;\\s*plural\\s*=\\s*(?:\\s|[-\\?\\|&=!<>+*/%:;a-zA-Z0-9_()])+)","m");if(!d.test(p))throw new Error("Syntax error in language file. Plural-Forms header is invalid ["+p+"]");var u=Gettext._locale_data[e].head["plural-forms"];/;\s*$/.test(u)||(u=u.concat(";"));var c="var plural; var nplurals; "+u+' return { "nplural" : nplurals, "plural" : (plural === true ? 1 : plural ? plural : 0) };';Gettext._locale_data[e].head.plural_func=new Function("n",c)}else"undefined"==typeof Gettext._locale_data[e].head.plural_func&&(Gettext._locale_data[e].head.plural_func=function(t){var e=1!=t?1:0;return{nplural:2,plural:e}})},Gettext.prototype.try_load_lang_po=function(t){var e=this.sjax(t);if(e){var a=this.uri_basename(t),r=this.parse_po(e),n={};return r&&(r[""]||(r[""]={}),r[""].domain||(r[""].domain=a),a=r[""].domain,n[a]=r,this.parse_locale_data(n)),1}},Gettext.prototype.uri_basename=function(t){var e;if(e=t.match(/^(.*\/)?(.*)/)){var a;return(a=e[2].match(/^(.*)\..+$/))?a[1]:e[2]}return""},Gettext.prototype.parse_po=function(t){for(var e={},a={},r="",n=[],i=t.split("\n"),o=0;o<i.length;o++){i[o]=i[o].replace(/(\n|\r)+$/,"");var s;if(/^$/.test(i[o])){if("undefined"!=typeof a.msgid){var l="undefined"!=typeof a.msgctxt&&a.msgctxt.length?a.msgctxt+Gettext.context_glue+a.msgid:a.msgid,p="undefined"!=typeof a.msgid_plural&&a.msgid_plural.length?a.msgid_plural:null,d=[];for(var u in a){var s;(s=u.match(/^msgstr_(\d+)/))&&(d[parseInt(s[1])]=a[u])}d.unshift(p),d.length>1&&(e[l]=d),a={},r=""}}else{if(/^#/.test(i[o]))continue;(s=i[o].match(/^msgctxt\s+(.*)/))?(r="msgctxt",a[r]=this.parse_po_dequote(s[1])):(s=i[o].match(/^msgid\s+(.*)/))?(r="msgid",a[r]=this.parse_po_dequote(s[1])):(s=i[o].match(/^msgid_plural\s+(.*)/))?(r="msgid_plural",a[r]=this.parse_po_dequote(s[1])):(s=i[o].match(/^msgstr\s+(.*)/))?(r="msgstr_0",a[r]=this.parse_po_dequote(s[1])):(s=i[o].match(/^msgstr\[0\]\s+(.*)/))?(r="msgstr_0",a[r]=this.parse_po_dequote(s[1])):(s=i[o].match(/^msgstr\[(\d+)\]\s+(.*)/))?(r="msgstr_"+s[1],a[r]=this.parse_po_dequote(s[2])):/^"/.test(i[o])?a[r]+=this.parse_po_dequote(i[o]):n.push("Strange line ["+o+"] : "+i[o])}}if("undefined"!=typeof a.msgid){var l="undefined"!=typeof a.msgctxt&&a.msgctxt.length?a.msgctxt+Gettext.context_glue+a.msgid:a.msgid,p="undefined"!=typeof a.msgid_plural&&a.msgid_plural.length?a.msgid_plural:null,d=[];for(var u in a){var s;(s=u.match(/^msgstr_(\d+)/))&&(d[parseInt(s[1])]=a[u])}d.unshift(p),d.length>1&&(e[l]=d),a={},r=""}if(e[""]&&e[""][1]){for(var c={},f=e[""][1].split(/\\n/),o=0;o<f.length;o++)if(f.length){var h=f[o].indexOf(":",0);if(-1!=h){var _=f[o].substring(0,h),x=f[o].substring(h+1),g=_.toLowerCase();c[g]&&c[g].length?n.push("SKIPPING DUPLICATE HEADER LINE: "+f[o]):/#-#-#-#-#/.test(g)?n.push("SKIPPING ERROR MARKER IN HEADER: "+f[o]):(x=x.replace(/^\s+/,""),c[g]=x)}else n.push("PROBLEM LINE IN HEADER: "+f[o]),c[f[o]]=""}e[""]=c}else e[""]={};return e},Gettext.prototype.parse_po_dequote=function(t){var e;return(e=t.match(/^"(.*)"/))&&(t=e[1]),t=t.replace(/\\"/g,'"')},Gettext.prototype.try_load_lang_json=function(t){var e=this.sjax(t);if(e){var a=this.JSON(e);return this.parse_locale_data(a),1}},Gettext.prototype.get_lang_refs=function(){for(var t=new Array,e=document.getElementsByTagName("link"),a=0;a<e.length;a++)if("gettext"==e[a].rel&&e[a].href){if("undefined"==typeof e[a].type||""==e[a].type)if(/\.json$/i.test(e[a].href))e[a].type="application/json";else if(/\.js$/i.test(e[a].href))e[a].type="application/json";else if(/\.po$/i.test(e[a].href))e[a].type="application/x-po";else{if(!/\.mo$/i.test(e[a].href))throw new Error("LINK tag with rel=gettext found, but the type and extension are unrecognized.");e[a].type="application/x-mo"}if(e[a].type=e[a].type.toLowerCase(),"application/json"==e[a].type)e[a].type="application/json";else if("text/javascript"==e[a].type)e[a].type="application/json";else if("application/x-po"==e[a].type)e[a].type="application/x-po";else{if("application/x-mo"!=e[a].type)throw new Error("LINK tag with rel=gettext found, but the type attribute ["+e[a].type+"] is unrecognized.");e[a].type="application/x-mo"}t.push(e[a])}return t},Gettext.prototype.textdomain=function(t){return t&&t.length&&(this.domain=t),this.domain},Gettext.prototype.gettext=function(t){var e,a,r,n;return this.dcnpgettext(null,e,t,a,r,n)},Gettext.prototype.dgettext=function(t,e){var a,r,n,i;return this.dcnpgettext(t,a,e,r,n,i)},Gettext.prototype.dcgettext=function(t,e,a){var r,n,i;return this.dcnpgettext(t,r,e,n,i,a)},Gettext.prototype.ngettext=function(t,e,a){var r,n;return this.dcnpgettext(null,r,t,e,a,n)},Gettext.prototype.dngettext=function(t,e,a,r){var n,i;return this.dcnpgettext(t,n,e,a,r,i)},Gettext.prototype.dcngettext=function(t,e,a,r,n){var i;return this.dcnpgettext(t,i,e,a,r,n,n)},Gettext.prototype.pgettext=function(t,e){var a,r,n;return this.dcnpgettext(null,t,e,a,r,n)},Gettext.prototype.dpgettext=function(t,e,a){var r,n,i;return this.dcnpgettext(t,e,a,r,n,i)},Gettext.prototype.dcpgettext=function(t,e,a,r){var n,i;return this.dcnpgettext(t,e,a,n,i,r)},Gettext.prototype.npgettext=function(t,e,a,r){var n;return this.dcnpgettext(null,t,e,a,r,n)},Gettext.prototype.dnpgettext=function(t,e,a,r,n){var i;return this.dcnpgettext(t,e,a,r,n,i)},Gettext.prototype.dcnpgettext=function(t,e,a,r,n,i){if(!this.isValidObject(a))return"";var o=this.isValidObject(r),s=this.isValidObject(e)?e+Gettext.context_glue+a:a,l=this.isValidObject(t)?t:this.isValidObject(this.domain)?this.domain:"messages",p=new Array;if("undefined"!=typeof Gettext._locale_data&&this.isValidObject(Gettext._locale_data[l]))p.push(Gettext._locale_data[l]);else if("undefined"!=typeof Gettext._locale_data)for(var d in Gettext._locale_data)p.push(Gettext._locale_data[d]);var u,c=[],f=!1;if(p.length)for(var h=0;h<p.length;h++){var _=p[h];if(this.isValidObject(_.msgs[s])){for(var x=0;x<_.msgs[s].length;x++)c[x]=_.msgs[s][x];if(c.shift(),u=_,f=!0,c.length>0&&0!=c[0].length)break}}(0==c.length||0==c[0].length)&&(c=[a,r]);var g=c[0];if(o){var m;if(f&&this.isValidObject(u.head.plural_func)){var y=u.head.plural_func(n);y.plural||(y.plural=0),y.nplural||(y.nplural=0),y.nplural<=y.plural&&(y.plural=0),m=y.plural}else m=1!=n?1:0;this.isValidObject(c[m])&&(g=c[m])}return g},Gettext.strargs=function(t,e){null==e||"undefined"==typeof e?e=[]:e.constructor!=Array&&(e=[e]);for(var a="";;){var r,n=t.indexOf("%");if(-1==n){a+=t;break}if(a+=t.substr(0,n),"%%"==t.substr(n,2))a+="%",t=t.substr(n+2);else if(r=t.substr(n).match(/^%(\d+)/)){var i=parseInt(r[1]),o=r[1].length;i>0&&null!=e[i-1]&&"undefined"!=typeof e[i-1]&&(a+=e[i-1]),t=t.substr(n+1+o)}else a+="%",t=t.substr(n+1)}return a},Gettext.prototype.strargs=function(t,e){return Gettext.strargs(t,e)},Gettext.prototype.isArray=function(t){return this.isValidObject(t)&&t.constructor==Array},Gettext.prototype.isValidObject=function(t){return null==t?!1:"undefined"==typeof t?!1:!0},Gettext.prototype.sjax=function(t){var e;if(e=window.XMLHttpRequest?new XMLHttpRequest:-1!=navigator.userAgent.toLowerCase().indexOf("msie 5")?new ActiveXObject("Microsoft.XMLHTTP"):new ActiveXObject("Msxml2.XMLHTTP"),!e)throw new Error("Your browser doesn't do Ajax. Unable to support external language files.");e.open("GET",t,!1);try{e.send(null)}catch(t){return}var a=e.status;if(200==a||0==a)return e.responseText;var r=e.statusText+" (Error "+e.status+")";return e.responseText.length&&(r+="\n"+e.responseText),void alert(r)},Gettext.prototype.JSON=function(data){return eval("("+data+")")};